generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum PublishJobState {
  awaiting_upload
  awaiting_payment
  processing
  finalized
  expired
  refunded
  failed
}

enum UploadStatus {
  initiated
  uploading
  uploaded
  failed
  aborted
  expired
}

model PublishJob {
  id                 String          @id @default(uuid()) @db.Uuid
  wallet             String
  ip                 String?
  sha256             String
  sizeBytes          BigInt          @map("size_bytes") @db.BigInt
  objectKey          String?         @map("object_key")
  uploadId           String?         @map("upload_id")
  uploadStatus       UploadStatus    @map("upload_status")
  reservationId      BigInt?         @map("reservation_id") @db.BigInt
  reserveTxHash      String?         @map("reserve_tx_hash")
  reserveConfirmedAt DateTime?       @map("reserve_confirmed_at")
  expiresAt          DateTime?       @map("expires_at")
  arweaveTxId        String?         @map("arweave_tx_id")
  finalizeTxHash     String?         @map("finalize_tx_hash")
  finalizedAt        DateTime?       @map("finalized_at")
  state              PublishJobState
  attempts           Int             @default(0)
  lastError          String?         @map("last_error")
  createdAt          DateTime        @default(now()) @map("created_at")
  updatedAt          DateTime        @updatedAt @map("updated_at")

  @@index([wallet])
  @@index([sha256])
  @@index([state])
  @@unique([reservationId])
  @@map("publish_jobs")
}
